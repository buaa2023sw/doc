# E-R 图

![E-R图.drawio](pictures/E-R%E5%9B%BE.drawio.png)



# 数据库基本表定义

## user（用户）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                                         |
| -------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------------------ |
| id       | int      | 20       | 是       | 是   | 否   | 自增主键                                                     |
| name     | varchar  | 255      | 是       | 否   | 否   | 用户名                                                       |
| email    | varchar  | 255      | 是       | 否   | 否   | 邮箱，唯一                                                   |
| password | varchar  | 255      | 是       | 否   | 否   | 密码                                                         |
| status   | varchar  | 255      | 是       | 否   | 否   | 用户状态，NORMAL(普通用户)/ILLEGAL(被禁用的普通用户)/ADMIN(管理员) |

## project（项目）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                                         |
| ----------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------------------ |
| id          | int      | 20       | 是       | 是   | 否   | 自增主键                                                     |
| create_time | varchar  | 255      | 是       | 否   | 否   | 创建时间                                                     |
| status      | varchar  | 255      | 是       | 否   | 否   | 项目状态，COMPLETED（已完成）/ INPROGRESS（进行中）/ NOTSTART（未开始） |
| name        | varchar  | 255      | 是       | 否   | 否   | 项目名                                                       |
| outline     | varchar  | 5000     | 是       | 否   | 否   | 项目概述                                                     |
| manager_id  | int      | 20       | 是       | 否   | 是   | 项目负责人的 id                                              |

## task（任务）

| 字段名称         | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                                         |
| ---------------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------------------ |
| id               | int      | 20       | 是       | 是   | 否   | 自增主键                                                     |
| name             | varchar  | 255      | 是       | 否   | 否   | 任务名                                                       |
| create_time      | varchar  | 255      | 是       | 否   | 否   | 任务创建时间                                                 |
| deadline         | varchar  | 255      | 是       | 否   | 否   | 任务截至时间                                                 |
| outline          | varchar  | 5000     | 是       | 否   | 否   | 任务概述                                                     |
| status           | varchar  | 255      | 是       | 否   | 否   | 任务状态：COMPLETED（已完成）/ INPROGRESS（进行中）/ NOTSTART（未开始） |
| contribute_level | int      | 20       | 是       | 否   | 否   | 贡献程度                                                     |
| parent_id        | int      | 20       | 否       | 否   | 是   | 该任务所属任务 id，如果该任务不是子任务则 parent_id = NULL。只允许一层子任务嵌套 |
| project_id       | int      | 20       | 否       | 否   | 是   | 所属项目 id                                                  |

## group（群组）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义        |
| ---------- | -------- | -------- | -------- | ---- | ---- | ----------- |
| id         | int      | 20       | 是       | 是   | 否   | 自增主键    |
| name       | varchar  | 255      | 是       | 否   | 否   | 名称        |
| outline    | varchar  | 5000     | 是       | 否   | 否   | 描述        |
| project_id | int      | 20       | 是       | 否   | 是   | 所属项目 id |

## message（消息）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                             |
| -------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------ |
| id       | int      | 20       | 是       | 是   | 否   | 自增主键                                         |
| type     | varchar  | 255      | 是       | 否   | 否   | 类型：TEXT（文本）/PIC（图片）/FILE（文件）      |
| content  | varchar  | 255      | 是       | 否   | 否   | 文本消息的内容，或图片或文件在服务器上的存储路径 |
| group_id | int      | 20       | 是       | 否   | 是   | 所属群组 id                                      |
| user_id  | int      | 20       | 是       | 否   | 是   | 发送该消息的用户的 id                            |
| time     | int      | 20       | 是       | 否   | 是   | 消息发送时间                                     |

## document（共享文档）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义        |
| ---------- | -------- | -------- | -------- | ---- | ---- | ----------- |
| id         | int      | 20       | 是       | 是   | 否   | 自增主键    |
| name       | varchar  | 255      | 是       | 否   | 否   | 名称        |
| outline    | varchar  | 5000     | 是       | 否   | 否   | 描述        |
| content    | varchar  | 10000    | 是       | 否   | 否   | 内容        |
| project_id | int      | 20       | 是       | 否   | 是   | 所属项目 id |
| user_id    | int      | 20       | 是       | 否   | 是   | 所属用户 id |

## post（公告）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义        |
| ---------- | -------- | -------- | -------- | ---- | ---- | ----------- |
| id         | int      | 20       | 是       | 是   | 否   | 自增主键    |
| name       | varchar  | 255      | 是       | 否   | 否   | 名称        |
| content    | varchar  | 10000    | 是       | 否   | 否   | 内容        |
| user_id    | int      | 20       | 是       | 否   | 是   | 发布用户 id |
| project_id | int      | 20       | 是       | 否   | 是   | 所属项目 id |

## repo（代码库）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义         |
| ----------- | -------- | -------- | -------- | ---- | ---- | ------------ |
| id          | int      | 20       | 是       | 是   | 否   | 自增主键     |
| name        | varchar  | 255      | 是       | 否   | 否   | 名称         |
| local_path  | varchar  | 255      | 是       | 否   | 否   | 本地存储路径 |
| remote_path | varchar  | 255      | 是       | 否   | 否   | 远程路径     |

## progress（进展）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                  |
| ----------- | -------- | -------- | -------- | ---- | ---- | --------------------- |
| id          | int      | 20       | 是       | 是   | 否   | 自增主键              |
| name        | varchar  | 255      | 是       | 否   | 否   | 名称                  |
| type        | varchar  | 255      | 是       | 否   | 否   | 类型：COMMIT/ISSUE/PR |
| remote_path | varchar  | 255      | 是       | 否   | 否   | github 网址           |
| repo_id     | int      | 20       | 是       | 否   | 是   | 所属代码库 id         |

## user_project（用户参与项目）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                                    |
| ---------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------------- |
| user_id    | int      | 20       | 是       | 是   | 是   | 用户 id                                                 |
| project_id | int      | 20       | 是       | 是   | 是   | 项目 id                                                 |
| role       | varchar  | 255      | 是       | 否   | 否   | 用户在项目中的角色：NORMAL（普通用户）/ ADMIN（管理员） |

## user_group（用户参与群组）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义                                                    |
| -------- | -------- | -------- | -------- | ---- | ---- | ------------------------------------------------------- |
| user_id  | int      | 20       | 是       | 是   | 是   | 用户 id                                                 |
| group_id | int      | 20       | 是       | 是   | 是   | 群组 id                                                 |
| role     | varchar  | 255      | 是       | 否   | 否   | 用户在项目中的角色：NORMAL（普通用户）/ ADMIN（管理员） |

## user_task（用户负责任务）

| 字段名称 | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义    |
| -------- | -------- | -------- | -------- | ---- | ---- | ------- |
| user_id  | int      | 20       | 是       | 是   | 是   | 用户 id |
| task_id  | int      | 20       | 是       | 是   | 是   | 任务 id |

## user_document（用户访问共享文档）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义        |
| ----------- | -------- | -------- | -------- | ---- | ---- | ----------- |
| user_id     | int      | 20       | 是       | 是   | 是   | 用户 id     |
| document_id | int      | 20       | 是       | 是   | 是   | 共享文档 id |

## user_project_repo（用户在项目中绑定的代码库）

| 字段名称   | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义      |
| ---------- | -------- | -------- | -------- | ---- | ---- | --------- |
| user_id    | int      | 20       | 是       | 是   | 是   | 用户 id   |
| project_id | int      | 20       | 是       | 是   | 是   | 项目 id   |
| repo_id    | int      | 20       | 是       | 是   | 是   | 代码库 id |

## progress_task（进展与任务的关联）

| 字段名称    | 数据类型 | 字段大小 | 必填字段 | 主键 | 外键 | 含义      |
| ----------- | -------- | -------- | -------- | ---- | ---- | --------- |
| repo_id     | int      | 20       | 是       | 是   | 是   | 代码库 id |
| progress_id | int      | 20       | 是       | 是   | 是   | 进展 id   |
